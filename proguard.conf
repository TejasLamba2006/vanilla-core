# ProGuard Configuration for SMP Core Plugin
# ============================================

# General optimizations
-optimizationpasses 3
-allowaccessmodification
-mergeinterfacesaggressively
# NOTE: Do NOT use -overloadaggressively - Paper's plugin remapper cannot handle
# multiple fields with the same obfuscated name (even with different types)
-repackageclasses 'com.tejaslamba.smpcore.internal'

# Keep source file names and line numbers for stack traces
-keepattributes SourceFile,LineNumberTable

# Keep annotations (important for Bukkit events)
-keepattributes *Annotation*

# Keep generic signatures (needed for some reflection)
-keepattributes Signature

# ============================================
# BUKKIT / SPIGOT API - Never obfuscate these
# ============================================

# Keep all Bukkit API classes untouched (they're provided, not included)
-dontwarn org.bukkit.**
-dontwarn org.spigotmc.**
-dontwarn net.md_5.**

# Keep WorldGuard classes
-dontwarn com.sk89q.**

# ============================================
# MAIN PLUGIN CLASS - Must remain accessible
# ============================================

# Keep the main plugin class (referenced in plugin.yml)
-keep public class com.tejaslamba.smpcore.Main {
    public *;
}

# ============================================
# COMMANDS - Keep command executors
# ============================================

# Keep all command classes
-keep public class com.tejaslamba.smpcore.command.* {
    public *;
}
-keep public class com.tejaslamba.smpcore.commands.* {
    public *;
}

# ============================================
# LISTENERS - Keep event handlers
# ============================================

# Keep all listener classes and their @EventHandler methods
-keep public class com.tejaslamba.smpcore.listener.* {
    @org.bukkit.event.EventHandler *;
    public *;
}

# ============================================
# FEATURES - Keep feature interface methods
# ============================================

# Keep Feature interface and implementations
-keep public interface com.tejaslamba.smpcore.feature.Feature {
    *;
}
-keep public class com.tejaslamba.smpcore.feature.BaseFeature {
    public protected *;
}
-keep public class com.tejaslamba.smpcore.features.* {
    public *;
}

# ============================================
# MANAGERS - Keep public API
# ============================================

# Keep manager classes (they're accessed via Main)
-keep public class com.tejaslamba.smpcore.manager.* {
    public *;
}

# ============================================
# MENUS - Keep menu classes
# ============================================

-keep public class com.tejaslamba.smpcore.menu.* {
    public *;
}

# ============================================
# INTERNAL CLASSES - Can be obfuscated
# ============================================

# These can be fully obfuscated:
# - com.tejaslamba.smpcore.itemlimiter.* (internal implementation)
# - com.tejaslamba.smpcore.utils.* (utility classes)

# But keep their public methods if accessed externally
-keep public class com.tejaslamba.smpcore.itemlimiter.ItemLimiterManager {
    public *;
}
-keep public class com.tejaslamba.smpcore.itemlimiter.ItemLimit {
    public *;
}

# ============================================
# ENUMS - Keep enum values
# ============================================

-keepclassmembers enum * {
    public static **[] values();
    public static ** valueOf(java.lang.String);
}

# ============================================
# SERIALIZATION - Keep serializable classes
# ============================================

-keepclassmembers class * implements java.io.Serializable {
    static final long serialVersionUID;
    private static final java.io.ObjectStreamField[] serialPersistentFields;
    private void writeObject(java.io.ObjectOutputStream);
    private void readObject(java.io.ObjectInputStream);
    java.lang.Object writeReplace();
    java.lang.Object readResolve();
}

# ============================================
# LAMBDAS & METHOD REFERENCES
# ============================================

# Keep lambda-related stuff
-keepclassmembers class * {
    private static synthetic java.lang.Object $deserializeLambda$(java.lang.invoke.SerializedLambda);
}

-keepclassmembernames class * {
    private static synthetic *** lambda$*(...);
}

# ============================================
# OBFUSCATION SETTINGS
# ============================================

# Use unique class member names
-useuniqueclassmembernames

# Don't warn about missing classes we don't include
-dontwarn javax.**
-dontwarn java.awt.**

# Aggressive obfuscation for non-API internal classes
-obfuscationdictionary proguard-dictionary.txt
-classobfuscationdictionary proguard-dictionary.txt
-packageobfuscationdictionary proguard-dictionary.txt
